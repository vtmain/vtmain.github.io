---
title: 进程空间
toc: false
date: 2017-05-17 10:49:09
updated: 2017-05-17 10:49:09
description:
tags: [进程, 线程]
categories:
---

占坑
<!-- more -->

- 进程空间分布图  

- 栈区/堆区/代码区/全局变量区  
1.代码段(code或text)  
　　代码段由各个函数产生，函数的每一个语句将最终经过编绎和汇编生成二进制机器代码(具体生生哪种体系结构的机器代码由编译器决定)。  
2.只读数据段(RO Data)  
　　只读数据段的特点是在运行中不需要改变。只读全局变量，只读局部变量，程序中使用的常量等会在编译时被放入到只读数据区。  
3.读写数据段(RW Data)  
　　读写数据段又称已初始化数据段，表示可以读也可以写的数据区。通常已初始化的全局变量和局部静态变量被放在了读写数据段，如：在函数中定义static char b[ 100]={“ABCDEFG”};读写数据区的特点是必须在程序经过初始化，如果只定义，没初始值，则不会生成读写数据区，而会定位为未初始化数据区(BSS)。  
4.未初始化数据段(BSS)  
　　该段中的数据没有经过初始化，不是目标文件中的一段。未初始化数据段只在运行的初始化阶段才会产生，因此它的大小不会影响目标文件的大小。  
5.堆(heap)  
　　堆内存只在程序运行时出现，一般由程序员分配和释放（malloc、free）。分配内存的函数所分配的内存空间在堆上，程序必须保证使用free释放，否则会发生内存泄漏。  
6.栈(stack)  
　　栈内存只在程序运行时出现，在函数内部使用的变量、函数的参数以及返回值将使用栈空间，栈空间由编译器自动分配和释放  

demo
```cpp
int a = 0; //全局初始化区，。rw data段
static int b=20; //全局初始化区，。 rw data段
char *p1; //全局未初始化区 .bss段
const int A = 10; //.rodata段
void main(void)
{
    int b; // 栈
    char s[] = "abc"; //栈
    char *p2; //栈
    static int c = 0; //全局(静态)初始化区 .rw data段
    char *p3 = "123456"; //123456\0在常量区ro data，p3 在栈上。
    p1 = (char*)malloc(10);//分配得来的10和20个字节的区域就在堆区
    p2 = (char*)malloc(20);
    strcpy(p1, "123456"); //123456\0 在常量区，编译器可能会将它与p3所指向的"123456"优化成一个地方

    free(p1);
    free(p2);
}
```
总结：
1.代码段、RO Data、RW Data及BSS这四个段都属于程序中的静态区域，堆和栈属于程序的动态区域；  
2.C程序经过编译连接生产的二进制可执行代码，只包含代码段、RO Data、RW Data，在程序运行后才会包含后面两个段，BSS中的数据将会在运行前置0；  
3.使用const定义的变量将放于程序的只读数据区；
4.函数体中定义的变量通常是在栈上，不需要在程序中进行管理，由编绎器处理。

- 线程加载，线程栈
